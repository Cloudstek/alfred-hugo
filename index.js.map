{"version":3,"sources":["index.js.flow"],"names":["CacheConf","require","Conf","fs","Fuse","got","moment","notifier","os","path","semver","FileCache","updater","Hugo","_fuseDefaults","keys","threshold","_options","useTmpCache","checkUpdates","updateSource","updateInterval","duration","updateNotification","updateItem","_outputBuffer","config","cwd","workflowMeta","data","cache","configName","version","item","items","title","alfredMeta","debug","console","error","arg","variables","alfredworkflow","push","map","addItem","key","value","keyword","callback","query","process","argv","filePath","cacheName","catch","err","then","result","current","latest","gt","checkedOnline","notify","name","subtitle","sender","timeout","icon","url","task","emptyDir","emptyDirSync","options","length","fuse","search","cacheDirChanged","isDuration","candidates","parseFloat","_rerun","rerun","output","log","cacheAge","json","cacheResult","get","set","response","body","maxAge","env","alfred_version","theme","alfred_theme","themeFile","themeBackground","alfred_theme_background","themeSelectionBackground","alfred_theme_selection_background","themeSubtext","alfred_theme_subtext","preferences","alfred_preferences","preferencesLocalHash","alfred_preferences_localhash","alfred_debug","HOME","homedir","themeName","alfredMajor","major","resolve","statSync","e","readJsonSync","throws","outputBuffer","cacheDir","alfred_workflow_cache","bundleId","alfred_workflow_bundleid","join","tmpdir","alfred_workflow_name","alfred_workflow_version","uid","alfred_workflow_uid","alfred_workflow_data","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["// @flow\n\nconst CacheConf = require('cache-conf');\nconst Conf = require('conf');\nconst fs = require('fs-promise');\nconst Fuse = require('fuse.js');\nconst got = require('got');\nconst moment = require('moment');\nconst notifier = require('node-notifier');\nconst os = require('os');\nconst path = require('path');\nconst semver = require('semver');\n\nconst FileCache = require('./file-cache');\nconst updater = require('./updater');\n\n/**\n * Hugo\n */\nclass Hugo {\n    /**\n     * FuseJS defaults\n     * @see https://github.com/krisk/fuse#options\n     * @type {Object}\n     */\n    _fuseDefaults: Object;\n\n    /**\n     * Hugo options\n     * @type {Object}\n     */\n    _options: Object;\n\n    /**\n     * Output buffer\n     * @type {Object}\n     */\n    _outputBuffer: Object;\n\n    /**\n     * Refresh (rerun) interval in seconds\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @type {number|null}\n     */\n    _rerun: ?number;\n\n    /**\n     * Cache store\n     * @see https://www.npmjs.com/package/cache-conf\n     * @type {CacheConf}\n     */\n    cache: CacheConf;\n\n    /**\n     * Configuration store\n     * @see https://www.npmjs.com/package/conf\n     * @type {Conf}\n     */\n    config: Conf;\n\n    /**\n     * Hugo constructor\n     * @constructor\n     */\n    constructor() {\n        // Set defaults for FuseJS\n        this._fuseDefaults = {\n            keys: ['title'],\n            threshold: 0.4\n        };\n\n        // Save options\n        this._options = {\n            useTmpCache: true,\n            checkUpdates: true,\n            updateSource: 'packal',\n            updateInterval: moment.duration(1, 'days'),\n            updateNotification: true,\n            updateItem: true\n        };\n\n        // Initialize output buffer\n        this._outputBuffer = {};\n\n        // Configure config store\n        this.config = new Conf({\n            cwd: this.workflowMeta.data\n        });\n\n        // Configure cache store\n        this.cache = new CacheConf({\n            configName: 'cache',\n            cwd: this.workflowMeta.cache,\n            version: this.workflowMeta.version\n        });\n    }\n\n    /**\n     * Alfred metadata\n     * @return {Object}\n     */\n    get alfredMeta(): Object {\n        let data = {\n            version: process.env.alfred_version,\n            theme: process.env.alfred_theme,\n            themeFile: '',\n            themeBackground: process.env.alfred_theme_background,\n            themeSelectionBackground: process.env.alfred_theme_selection_background,\n            themeSubtext: parseFloat(process.env.alfred_theme_subtext),\n            preferences: process.env.alfred_preferences,\n            preferencesLocalHash: process.env.alfred_preferences_localhash,\n            debug: process.env.alfred_debug === '1'\n        };\n\n        if (process.env.HOME && process.env.alfred_theme) {\n            let homedir = process.env.HOME || '';\n            let themeName = process.env.alfred_theme || '';\n            let alfredMajor = semver.major(process.env.alfred_version);\n\n            let themeFile = path.resolve(homedir, 'Library', 'Application Support', 'Alfred ' + alfredMajor,\n                'Alfred.alfredpreferences', 'themes', themeName, 'theme.json');\n\n            try {\n                fs.statSync(themeFile);\n                data.themeFile = themeFile;\n            } catch (e) {}\n        }\n\n        return data;\n    }\n\n    /**\n     * Alfred theme\n     * @return {Object}\n     */\n    get alfredTheme(): Object {\n        let themeFile = this.alfredMeta.themeFile;\n\n        if (!themeFile) {\n            return {};\n        }\n\n        return fs.readJsonSync(themeFile, {throws: false}) || {};\n    }\n\n    /**\n     * Alfred user input\n     * @return {string}\n     */\n    get input(): string {\n        if (process.argv.length > 3) {\n            return process.argv[3] || '';\n        }\n        return process.argv[2] || '';\n    }\n\n    /**\n     * Number of Alfred items in the current output buffer\n     * @return {number}\n     */\n    get itemCount(): number {\n        if (this.outputBuffer && this.outputBuffer.items) {\n            return this.outputBuffer.items.length;\n        }\n\n        return 0;\n    }\n\n    /**\n     * Current output buffer\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @return {Object} Object to be output and interpreted by Alfred\n     */\n    get outputBuffer(): Object {\n        return this._outputBuffer;\n    }\n\n    /**\n     * Workflow metadata\n     * @return {Object}\n     */\n    get workflowMeta(): Object {\n        let cacheDir = process.env.alfred_workflow_cache;\n        let bundleId = process.env.alfred_workflow_bundleid;\n\n        if (bundleId && this._options.useTmpCache === true) {\n            cacheDir = path.resolve(path.join(os.tmpdir(), bundleId));\n        }\n\n        return {\n            name: process.env.alfred_workflow_name,\n            version: process.env.alfred_workflow_version,\n            uid: process.env.alfred_workflow_uid,\n            bundleId: bundleId,\n            data: process.env.alfred_workflow_data,\n            cache: cacheDir,\n            icon: path.join(process.cwd(), 'icon.png')\n        };\n    }\n\n    /**\n     * Add item to output buffer\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @param {Object} item Item to add\n     * @type {Hugo}\n     */\n    addItem(item: Object): Hugo {\n        if (!this._outputBuffer.items) {\n            this._outputBuffer.items = [];\n        }\n\n        if (!item.title) {\n            if (this.alfredMeta.debug === true) {\n                console.error('Item skipped, missing title.');\n            }\n            return this;\n        }\n\n        if (item.arg && typeof item.arg === 'object') {\n            let arg = item.arg.arg || '';\n            let variables = item.arg.variables || {};\n\n            item.arg = JSON.stringify({\n                alfredworkflow: {\n                    arg: arg,\n                    variables: variables\n                }\n            });\n        }\n\n        this._outputBuffer.items.push(item);\n\n        return this;\n    }\n\n    /**\n     * Add items to output buffer\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @param {Array.<Object>} items List of items to add\n     * @type {Hugo}\n     */\n    addItems(items: Array<Object>): Hugo {\n        if (!this._outputBuffer.items) {\n            this._outputBuffer.items = items;\n            return this;\n        }\n\n        items.map(item => {\n            this.addItem(item);\n            return item;\n        });\n\n        return this;\n    }\n\n    /**\n     * Add session variable to output buffer\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @param {string} key Variable key\n     * @param {string} value Variable value\n     * @type {Hugo}\n     */\n    addVariable(key: string, value: string): Hugo {\n        if (!this._outputBuffer.variables) {\n            this._outputBuffer.variables = {};\n        }\n\n        this._outputBuffer.variables[key] = value;\n\n        return this;\n    }\n\n    /**\n     * Add session variables to output buffer\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json/\n     * @param {Object} variables List of variables to add\n     * @type {Hugo}\n     */\n    addVariables(variables: Object): Hugo {\n        if (!this._outputBuffer.variables) {\n            this._outputBuffer.variables = variables;\n            return this;\n        }\n\n        this._outputBuffer.variables = Object.assign({}, this._outputBuffer.variables, variables);\n\n        return this;\n    }\n\n    /**\n     * Run a callback when first script argument matches keyword. Callback will have third argument as query parameter.\n     * @example node index.js myaction \"my query\"\n     * @param {string} keyword Action name\n     * @param {Function} callback Callback to execute when query matches action name\n     * @type {Hugo}\n     */\n    action(keyword: string, callback: (query: string) => void): Hugo {\n        let query: string = process.argv[2];\n\n        if (query && callback && query === keyword) {\n            query = process.argv[3] || '';\n            callback(query);\n        }\n\n        return this;\n    }\n\n    /**\n     * Cache processed data\n     * This allows you to read and process the data once, then storing it in cache until the file has changed again.\n     *\n     * @param {string} filepath File path\n     * @param {string} cacheName Cache name (must be unique for each file)\n     * @return {FileCache}\n     */\n    cacheFile(filePath: string, cacheName: string): FileCache {\n        return new FileCache(filePath, cacheName, this.workflowMeta.cache);\n    }\n\n    /**\n     * Check for updates and notify the user\n     * @async\n     * @return {Promise}\n     */\n    async checkUpdates() {\n        // No need to check if we're not showing anything, duh.\n        if (this._options.checkUpdates !== true ||\n                (this._options.updateItem !== true && this._options.updateNotification !== true)) {\n            return;\n        }\n\n        await updater.checkUpdates(this._options.updateSource, this._options.updateInterval)\n            .catch(err => {\n                console.error(err);\n            })\n            .then(result => {\n                if (!result) {\n                    return;\n                }\n\n                // Version information\n                let current: string = this.workflowMeta.version;\n                let latest: string = result.version;\n\n                // Display notification\n                if (semver.gt(latest, current)) {\n                    if (result.checkedOnline === true && this._options.updateNotification === true) {\n                        notifier.notify({\n                            title: this.workflowMeta.name || 'Alfred',\n                            subtitle: `Workflow version ${latest} available. Current version: ${current}.`,\n                            sender: 'com.runningwithcrayons.Alfred-3',\n                            timeout: 10\n                        });\n                    }\n                    if (this._options.updateItem === true) {\n                        this.addItem({\n                            title: `Workflow update available!`,\n                            subtitle: `Version ${latest} is available. Current version: ${current}.`,\n                            icon: this.workflowMeta.icon,\n                            arg: {\n                                arg: result.url,\n                                variables: {\n                                    task: 'wfUpdate'\n                                }\n                            }\n                        });\n                    }\n                }\n            });\n    }\n\n    /**\n     * Clear cache\n     * @async\n     * @return {Promise}\n     */\n    async clearCache() {\n        if (this.workflowMeta.cache) {\n            return fs.emptyDir(this.workflowMeta.cache);\n        }\n    }\n\n    /**\n     * Clear cache (sync)\n     * @return {void}\n     */\n    clearCacheSync() {\n        if (this.workflowMeta.cache) {\n            return fs.emptyDirSync(this.workflowMeta.cache);\n        }\n    }\n\n    /**\n     * Filter added items (output buffer) with fuse.js\n     * @see http://fusejs.io\n     * @param {string} query Search string\n     * @param {Object} options fuse.js options\n     * @return {Hugo}\n     */\n    filterItems(query: string, options: Object = {}): Hugo {\n        options = Object.assign({}, this._fuseDefaults, options);\n\n        if (query.length === 0) {\n            return this;\n        }\n\n        // Create fuse.js fuzzy search object\n        let fuse = new Fuse(this._outputBuffer.items, options);\n\n        // Set output buffer to matching items\n        this._outputBuffer.items = fuse.search(query) || [];\n\n        return this;\n    }\n\n    /**\n     * Set Hugo options\n     * @param {Object} options Options to set\n     * @return {Hugo}\n     */\n    options(options: Object): Hugo {\n        let cacheDirChanged = 'useTmpCache' in options && options.useTmpCache !== this._options.useTmpCache;\n\n        // Convert updateInterval to moment.Duration object\n        if (options.updateInterval && !moment.isDuration(options.updateInterval)) {\n            if (options.updateInterval < 1) {\n                delete options.updateInterval;\n            } else {\n                options.updateInterval = moment.duration(options.updateInterval, 'seconds') || moment.duration(1, 'days');\n            }\n        }\n\n        // Update options\n        this._options = Object.assign({}, this._options, options);\n\n        // Update cache dir\n        if (cacheDirChanged) {\n            this.cache = new CacheConf({\n                configName: 'cache',\n                cwd: this.workflowMeta.cache,\n                version: this.workflowMeta.version\n            });\n        }\n\n        return this;\n    }\n\n    /**\n     * Filter list of candidates with fuse.js\n     * @see http://fusejs.io\n     * @param {Array.<Object>} candidates Input data\n     * @param {string} query Search string\n     * @param {Object} options fuse.js options\n     * @return {Array.<Object>}\n     */\n    matches(candidates: Array<Object>, query: string, options: Object = {}): Array<Object> {\n        options = Object.assign({}, this._fuseDefaults, options);\n\n        if (query.length === 0) {\n            return candidates;\n        }\n\n        // Create fuse.js fuzzy search object\n        let fuse = new Fuse(candidates, options);\n\n        // Return results\n        return fuse.search(query) || [];\n    }\n\n    /**\n     * Set rerun parameter\n     * @see https://www.alfredapp.com/help/workflows/inputs/script-filter/json\n     * @param {number} value Interval to rerun the script when idle\n     * @return {Hugo}\n     */\n    rerun(value: number): Hugo {\n        value = parseFloat(value);\n\n        if (value && value > 0.1 && value <= 5) {\n            this._rerun = value;\n        }\n\n        return this;\n    }\n\n    /**\n     * Flush the output buffer so Alfred shows our items\n     * @async\n     */\n    async feedback() {\n        if (this._rerun) {\n            this._outputBuffer.rerun = this._rerun;\n        }\n\n        // Check for updates\n        if (this._options.checkUpdates === true) {\n            await this.checkUpdates()\n                .catch(() => {});\n        }\n\n        let output = this._outputBuffer;\n\n        // Output JSON\n        console.log(JSON.stringify(output, null, '\\t'));\n\n        // Reset output buffer\n        this._outputBuffer = {};\n\n        return output;\n    }\n\n    /**\n     * Fetch url and parse JSON. Useful for REST APIs.\n     * @see https://www.npmjs.com/package/got\n     * @param {string} url Url to request\n     * @param {Object} options http.request options\n     * @param {number|null} cacheAge Cache lifetime (in seconds), above 0 to enable or null to disable.\n     * @return {Object|string}\n     * @async\n     */\n    async fetch(url: string, options: Object = {}, cacheAge: ?number = null): Object|string {\n        // Set default options\n        options = Object.assign({}, {\n            json: true\n        }, options);\n\n        // Check cache for a hit\n        if (cacheAge && cacheAge > 0) {\n            let cacheResult: Object|string|null = this.cache.get(url);\n\n            if (cacheResult) {\n                return cacheResult;\n            }\n        }\n\n        // Do request\n        return got(url, options)\n            .then(response => {\n                if (cacheAge && cacheAge > 0) {\n                    this.cache.set(url, response.body, {\n                        maxAge: cacheAge * 1000\n                    });\n                }\n\n                return response.body;\n            });\n    }\n}\n\nmodule.exports = new Hugo();\n"]}